dist: trusty

sudo: required

group: edge

language: python

python:
  - "2.7"
  - "3.2"

services:
  -docker

addons:
  sonarqube:
    organization: "laurelmcintyre-github" 

before_install:
  - sudo pip install codecov
  - sudo pip install nose2
#  - docker build -t carlad/sinatra .
#  - docker run -d -p 127.0.0.1:80:4567 carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec foreman start;"
#  - docker ps -a
#  - docker run carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec rake test"
  
#install: pip install -r requirements.txt

script:
  - nose2 --with-coverage mytan
  - coverage run mytan.py 42
  - codecov
  - sonar-scanner
  
after_success: |
  if [ -n "$GITHUB" ]; then
    cd "$TRAVIS_BUILD_DIR"
    pydoc -w $TRAVIS_BUILD_DIR
    mkdir docs
    mv *.html docs/.
    cd docs
    git init
    git checkout -b gh-pages
    git add .
    git -c user.name='travis' -c user.email='travis' commit -m init
    git push -f https://laurelmcintyre:$GITHUB@github.com/laurelmcintyre/python-ci gh-pages 
  fi
